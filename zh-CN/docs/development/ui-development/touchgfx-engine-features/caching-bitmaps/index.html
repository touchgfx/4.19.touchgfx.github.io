<!doctype html>
<html class="docs-version-current" lang="zh-CN" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.9">
<link rel="search" type="application/opensearchdescription+xml" title="TouchGFX Documentation" href="/4.19/zh-CN/opensearch.xml">
<script src="/4.19/js/fix-location.js"></script><title data-react-helmet="true">缓存位图 | TouchGFX Documentation</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:image" content="https://support.touchgfx.com/4.19/zh-CN/img/meta-image.png"><meta data-react-helmet="true" name="twitter:image" content="https://support.touchgfx.com/4.19/zh-CN/img/meta-image.png"><meta data-react-helmet="true" property="og:url" content="https://support.touchgfx.com/4.19/zh-CN/docs/development/ui-development/touchgfx-engine-features/caching-bitmaps"><meta data-react-helmet="true" name="docsearch:language" content="zh-CN"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="缓存位图 | TouchGFX Documentation"><meta data-react-helmet="true" name="description" content="在本节中，我们将讨论TouchGFX中的位图缓存。 位图缓存是专用RAM缓冲区，应用可将位图保存（或缓存）在其中。 如果缓存了位图，在绘制位图时，TouchGFX将自动使用RAM缓存作为像素来源。"><meta data-react-helmet="true" property="og:description" content="在本节中，我们将讨论TouchGFX中的位图缓存。 位图缓存是专用RAM缓冲区，应用可将位图保存（或缓存）在其中。 如果缓存了位图，在绘制位图时，TouchGFX将自动使用RAM缓存作为像素来源。"><link data-react-helmet="true" rel="shortcut icon" href="/4.19/zh-CN/img/favicon.png"><link data-react-helmet="true" rel="canonical" href="https://support.touchgfx.com/4.19/zh-CN/docs/development/ui-development/touchgfx-engine-features/caching-bitmaps"><link data-react-helmet="true" rel="alternate" href="https://support.touchgfx.com/4.19/docs/development/ui-development/touchgfx-engine-features/caching-bitmaps" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://support.touchgfx.com/4.19/ko/docs/development/ui-development/touchgfx-engine-features/caching-bitmaps" hreflang="ko"><link data-react-helmet="true" rel="alternate" href="https://support.touchgfx.com/4.19/ja/docs/development/ui-development/touchgfx-engine-features/caching-bitmaps" hreflang="ja"><link data-react-helmet="true" rel="alternate" href="https://support.touchgfx.com/4.19/zh-CN/docs/development/ui-development/touchgfx-engine-features/caching-bitmaps" hreflang="zh-CN"><link data-react-helmet="true" rel="alternate" href="https://support.touchgfx.com/4.19/zh-TW/docs/development/ui-development/touchgfx-engine-features/caching-bitmaps" hreflang="zh-TW"><link data-react-helmet="true" rel="alternate" href="https://support.touchgfx.com/4.19/docs/development/ui-development/touchgfx-engine-features/caching-bitmaps" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://B8LNOI0XWD-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/4.19/zh-CN/assets/css/styles.321a00f7.css">
<link rel="preload" href="/4.19/zh-CN/assets/js/runtime~main.569d9f0f.js" as="script">
<link rel="preload" href="/4.19/zh-CN/assets/js/main.511c8c5c.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" target="_self" href="/4.19/zh-CN/docs/introduction/welcome"><div class="navbar__logo"><img src="/4.19/zh-CN/img/logo.svg" alt="TouchGFX" class="themedImage_1VuW themedImage--light_3UqQ"><img src="/4.19/zh-CN/img/logo.svg" alt="TouchGFX" class="themedImage_1VuW themedImage--dark_hz6m"></div></a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" class="navbar__link"><span><span>简体中文</span></span></a><ul class="dropdown__menu"><li><a href="/4.19/docs/development/ui-development/touchgfx-engine-features/caching-bitmaps" target="_self" rel="noopener noreferrer" class="dropdown__link" style="text-transform:capitalize">English</a></li><li><a href="/4.19/ko/docs/development/ui-development/touchgfx-engine-features/caching-bitmaps" target="_self" rel="noopener noreferrer" class="dropdown__link" style="text-transform:capitalize">한국어</a></li><li><a href="/4.19/ja/docs/development/ui-development/touchgfx-engine-features/caching-bitmaps" target="_self" rel="noopener noreferrer" class="dropdown__link" style="text-transform:capitalize">日本語</a></li><li><a href="/4.19/zh-CN/docs/development/ui-development/touchgfx-engine-features/caching-bitmaps" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" style="text-transform:capitalize">简体中文</a></li><li><a href="/4.19/zh-TW/docs/development/ui-development/touchgfx-engine-features/caching-bitmaps" target="_self" rel="noopener noreferrer" class="dropdown__link" style="text-transform:capitalize">繁體中文</a></li></ul></div></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" href="/4.19/zh-CN/docs/introduction/welcome">4.19</a><ul class="dropdown__menu"><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/4.19/zh-CN/docs/development/ui-development/touchgfx-engine-features/caching-bitmaps">4.19</a></li><li><a href="https://support.touchgfx.com/4.18" target="_blank" rel="noopener noreferrer" class="dropdown__link"><span>4.18<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li><a href="https://support.touchgfx.com/4.17" target="_blank" rel="noopener noreferrer" class="dropdown__link"><span>4.17<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li><a href="https://support.touchgfx.com/4.16" target="_blank" rel="noopener noreferrer" class="dropdown__link"><span>4.16<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li><a href="https://support.touchgfx.com/4.15" target="_blank" rel="noopener noreferrer" class="dropdown__link"><span>4.15<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li><a href="https://support.touchgfx.com/4.14" target="_blank" rel="noopener noreferrer" class="dropdown__link"><span>4.14<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li><a href="https://support.touchgfx.com/4.13" target="_blank" rel="noopener noreferrer" class="dropdown__link"><span>4.13<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><a href="https://community.st.com/s/topic/0TO0X0000003iw6WAA/touchgfx" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Community</a><a href="https://touchgfx.com/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">TouchGFX.com</a><div class="searchBox_1ZXk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_35hR" type="button"></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Introduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Basic Concepts</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Development</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/4.19/zh-CN/docs/development/development-introduction">开发简介</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Hardware Selection</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Board Bring Up</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">TouchGFX AL Development</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#" tabindex="0">UI Development</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/4.19/zh-CN/docs/development/ui-development/ui-development-introduction">UI开发介绍</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Software Architecture</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Working with TouchGFX</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Designer User Guide</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#" tabindex="0">TouchGFX Engine Features</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/4.19/zh-CN/docs/development/ui-development/touchgfx-engine-features/custom-triggers-and-actions">自定义触发条件和操作</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/4.19/zh-CN/docs/development/ui-development/touchgfx-engine-features/position-size">Position and size</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/4.19/zh-CN/docs/development/ui-development/touchgfx-engine-features/custom-containers">自定义容器</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/4.19/zh-CN/docs/development/ui-development/touchgfx-engine-features/caching-bitmaps">缓存位图</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/4.19/zh-CN/docs/development/ui-development/touchgfx-engine-features/custom-widgets">自定义小部件</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/4.19/zh-CN/docs/development/ui-development/touchgfx-engine-features/canvas-widgets">画布控件</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/4.19/zh-CN/docs/development/ui-development/touchgfx-engine-features/dynamic-bitmaps">动态位图</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/4.19/zh-CN/docs/development/ui-development/touchgfx-engine-features/using-binary-fonts">Binary Fonts</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/4.19/zh-CN/docs/development/ui-development/touchgfx-engine-features/font-cache">字体缓存</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/4.19/zh-CN/docs/development/ui-development/touchgfx-engine-features/using-binary-translations">Binary Translations</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/4.19/zh-CN/docs/development/ui-development/touchgfx-engine-features/backend-communication">Backend Communication</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/4.19/zh-CN/docs/development/ui-development/touchgfx-engine-features/mixins">Mixins</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/4.19/zh-CN/docs/development/ui-development/touchgfx-engine-features/texts-and-fonts">Texts and Fonts</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/4.19/zh-CN/docs/development/ui-development/touchgfx-engine-features/languages-and-characters">Languages and Characters</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/4.19/zh-CN/docs/development/ui-development/touchgfx-engine-features/video">MJPEG Video</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">UI Components</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Scenarios</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Scenarios</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Miscellaneous</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Tutorials</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">API</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Resources</a></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD theme-doc-toc-mobile tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>缓存位图</h1></header><p>在本节中，我们将讨论TouchGFX中的位图缓存。 位图缓存是专用RAM缓冲区，应用可将位图保存（或缓存）在其中。 如果缓存了位图，在绘制位图时，TouchGFX将自动使用RAM缓存作为像素来源。</p><p>位图缓存在许多情况下十分有用。 从RAM读取数据通常比从闪存读取要快（特别是在使用纹理映射器时，原因是它使用非线性存储器存取），因此，缓存到RAM可提升UI性能。 注意，从内部闪存缓存到外部RAM可能会降低性能。 如果缓存到RAM，由于将从RAM读取位图（在某些情况下，写入闪存要求是非存储器映射闪存），因此可以在显示UI的同时将闪存用于其他目的（如日志文件）。  当您需要修改位图像素时，位图需位于可修改的存储器中，因此这一点也很有用。</p><p>出于性能方面的考虑，TouchGFX要求存储在外部闪存中的所有图形数据都能直接访问（通过指针），无需通过驱动层。 这意味着TouchGFX不能从非存储器映射闪存（如SD卡）直接渲染。 为了打破这一限制，位图缓存提供了一种在上电期间缓存RAM中的一些或全部位图数据的机制。 因此，当您需要将位图保存在慢速外部存储器（如U盘或SD卡）上时，位图缓存将十分有用。</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="setup-the-bitmap-cache">设置位图缓存<a aria-hidden="true" class="hash-link" href="#setup-the-bitmap-cache" title="Direct link to heading">​</a></h2><p>为了使用位图缓存特性，您首先需要向TouchGFX提供位图缓存配置，然后（在某些情况下）提供<code>BlockCopy</code>函数的硬件特定的实现，以便从外部存储器读取数据。</p><h3 class="anchor anchorWithStickyNavbar_31ik" id="bitmap-cache-configuration">位图缓存配置<a aria-hidden="true" class="hash-link" href="#bitmap-cache-configuration" title="Direct link to heading">​</a></h3><p>The bitmap cache configuration consists of a pointer to a buffer and the size of the buffer. These two values must be provided to TouchGFX in the call to Bitmap::setCache. This call is normally found in the FrontendApplication.cpp file:</p><div class="code-header"><div><h5>FrontendApplication.cpp (extract)</h5></div></div><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly cpp"><pre tabindex="0" class="prism-code language-cpp codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="font-style:italic">include</span><span class="token macro property"> </span><span class="token macro property string" style="color:rgb(195, 232, 141)">&lt;gui/common/FrontendApplication.hpp&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="font-style:italic">include</span><span class="token macro property"> </span><span class="token macro property string" style="color:rgb(195, 232, 141)">&lt;touchgfx/Bitmap.hpp&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token class-name" style="color:rgb(255, 203, 107)">FrontendApplication</span><span class="token operator" style="color:rgb(137, 221, 255)">::</span><span class="token function" style="color:rgb(130, 170, 255)">FrontendApplication</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">Model</span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;</span><span class="token plain"> m</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> FrontendHeap</span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;</span><span class="token plain"> heap</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">FrontendApplicationBase</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">m</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> heap</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Place cache start address in SDRAM at address 0xC0008000;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">uint16_t</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> cacheStartAddr </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">uint16_t</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token number" style="color:rgb(247, 140, 108)">0xC0008000</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">uint32_t</span><span class="token plain"> cacheSize </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0x300000</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//3 MB, as example</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token class-name" style="color:rgb(255, 203, 107)">Bitmap</span><span class="token operator" style="color:rgb(137, 221, 255)">::</span><span class="token function" style="color:rgb(130, 170, 255)">setCache</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">cacheStartAddr</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> cacheSize</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">复制</button></div></div><p>In the above example a 3 MB buffer in external memory is passed to TouchGFX as bitmap cache. The address is selected by the application programmer. In the next example we just declare an array and just pass the address and size of the array. The specific location of the array will depend on your linker script. This method is most often used when creating a (small) bitmap cache in internal RAM:</p><div class="code-header"><div><h5>FrontendApplication.cpp (extract)</h5></div></div><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly cpp"><pre tabindex="0" class="prism-code language-cpp codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="font-style:italic">include</span><span class="token macro property"> </span><span class="token macro property string" style="color:rgb(195, 232, 141)">&lt;gui/common/FrontendApplication.hpp&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="font-style:italic">include</span><span class="token macro property"> </span><span class="token macro property string" style="color:rgb(195, 232, 141)">&lt;touchgfx/Bitmap.hpp&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Define an array for the bitmap cache</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">uint16_t</span><span class="token plain"> cache</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token number" style="color:rgb(247, 140, 108)">128</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token number" style="color:rgb(247, 140, 108)">1024</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//256 KB cache</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token class-name" style="color:rgb(255, 203, 107)">FrontendApplication</span><span class="token operator" style="color:rgb(137, 221, 255)">::</span><span class="token function" style="color:rgb(130, 170, 255)">FrontendApplication</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">Model</span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;</span><span class="token plain"> m</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> FrontendHeap</span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;</span><span class="token plain"> heap</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">FrontendApplicationBase</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">m</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> heap</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token class-name" style="color:rgb(255, 203, 107)">Bitmap</span><span class="token operator" style="color:rgb(137, 221, 255)">::</span><span class="token function" style="color:rgb(130, 170, 255)">setCache</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">cache</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">sizeof</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">cache</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">复制</button></div></div><h4 class="anchor anchorWithStickyNavbar_31ik" id="enabling-bitmap-cache-with-touchgfx-generator">Enabling Bitmap cache with TouchGFX Generator<a aria-hidden="true" class="hash-link" href="#enabling-bitmap-cache-with-touchgfx-generator" title="Direct link to heading">​</a></h4><p>If you are using CubeMX and TouchGFX Generator, enabling and configuring of the bitmap cache could also be done in TouchGFXHAL.cpp.</p><div class="code-header"><div><h5>TouchGFXHAL.cpp (extract)</h5></div></div><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly cpp"><pre tabindex="0" class="prism-code language-cpp codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">TouchGFXHAL</span><span class="token operator" style="color:rgb(137, 221, 255)">::</span><span class="token function" style="color:rgb(130, 170, 255)">initialize</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/* Initialize TouchGFX Engine */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token class-name" style="color:rgb(255, 203, 107)">TouchGFXGeneratedHAL</span><span class="token operator" style="color:rgb(137, 221, 255)">::</span><span class="token function" style="color:rgb(130, 170, 255)">initialize</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">uint16_t</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> cacheStartAddr </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">uint16_t</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token number" style="color:rgb(247, 140, 108)">0xC0008000</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">uint32_t</span><span class="token plain"> cacheSize </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0x300000</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//3 MB, as example</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    touchgfx</span><span class="token operator" style="color:rgb(137, 221, 255)">::</span><span class="token class-name" style="color:rgb(255, 203, 107)">Bitmap</span><span class="token operator" style="color:rgb(137, 221, 255)">::</span><span class="token function" style="color:rgb(130, 170, 255)">setCache</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">cache</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">sizeof</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">cache</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">复制</button></div></div><p>If you want to reuse the cache, the previous one must be removed before setting the new one, this is done by calling <code>touchgfx::Bitmap::removeCache()</code>. You don&#x27;t need to remove the cache, if you only set it once in your application.</p><p>If you need to cache all your bitmaps, of course the size of the cache must be large enough to contain all your bitmap data. Note: There is a small amount of memory used for bookkeeping (8 bytes x number of bitmaps in the application), so you must allocate slightly more memory than actually needed for the raw pixel data. This amount depends on the number of bitmaps in your application, but a few kilobytes of additional memory is usually enough.</p><h3 class="anchor anchorWithStickyNavbar_31ik" id="blockcopy-copies-data-from-flash-to-the-cache">BlockCopy Copies Data from Flash to the Cache<a aria-hidden="true" class="hash-link" href="#blockcopy-copies-data-from-flash-to-the-cache" title="Direct link to heading">​</a></h3><p>When you cache a bitmap, TouchGFX copies the pixels from the original location to the bitmap cache using the <code>BlockCopy</code> function in the HAL class.</p><p>If your bitmaps are stored in normal addressable flash (like internal flash or a memory mapped external flash like a QSPI-flash), you do not need to do anything. The built-in implementation works fine.</p><p>On the other hand, if your bitmaps are stored in flash that is not addressable, e.g. a filesystem or non-memory mapped flash, then the standard copy method is not sufficient and you need to provide an updated version that is able to read from your specific flash storage.</p><p>Read more about this topic <a href="/4.19/zh-CN/docs/development/scenarios/using-non-memory-mapped-flash">Using Non-Memory Mapped flash for storing images</a> section.</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="cache-operations">Cache Operations<a aria-hidden="true" class="hash-link" href="#cache-operations" title="Direct link to heading">​</a></h2><p>The bitmap caching operations are all placed in the <code>Bitmap</code> class:</p><table><thead><tr><th><strong><code>Bitmap</code> caching method</strong></th><th><strong>Description</strong></th></tr></thead><tbody><tr><td><code>bool Bitmap::cache(BitmapId id)</code></td><td>This method caches a bitmap. The bitmap is only cached if enough unused memory is available in the cache. Returns true if the bitmap was cached. Caching an already cached bitmap does not do any work.</td></tr><tr><td><code>bool Bitmap::cacheReplaceBitmap(BitmapId out, BitmapId in)</code></td><td>This method replaces a bitmap (out) in the cache with another bitmap (in). The method will only succeed if the bitmap to be replaced is already cached and if the bitmaps have the same size (in bytes).</td></tr><tr><td><code>bool Bitmap::cacheRemoveBitmap(BitmapId id)</code></td><td>This method removes a bitmap from the cache. The memory used by the bitmap can be used for caching of another bitmap afterwards.</td></tr><tr><td><code>void Bitmap::clearCache()</code></td><td>This method removes all the cached bitmaps from the cache.</td></tr><tr><td><code>void Bitmap::cacheAll()</code></td><td>This method caches all bitmaps. It can not be used if the amount of RAM allocated for the cache (or available) is less than the total size of the bitmaps.</td></tr></tbody></table><h2 class="anchor anchorWithStickyNavbar_31ik" id="cache-strategies">Cache Strategies<a aria-hidden="true" class="hash-link" href="#cache-strategies" title="Direct link to heading">​</a></h2><p>When the amount of RAM that you can allocate for your bitmap cache is less than the total size of the bitmaps you can not cache all the bitmaps during startup. You can e.g. select to cache only the bitmaps needed for the first screen. When you change between your screens you can remove some or all of the cached bitmaps and cache the bitmaps needed for the next screen. This is exemplified in the next section.</p><h3 class="anchor anchorWithStickyNavbar_31ik" id="cache-bitmap-on-a-screen-basis">Cache Bitmap on a Screen Basis<a aria-hidden="true" class="hash-link" href="#cache-bitmap-on-a-screen-basis" title="Direct link to heading">​</a></h3><p>Your application user interface is composed of a set of Views. The Views probably all use some bitmaps.  A simple strategy for caching is to cache all the bitmaps used by a View in the <code>View::setupScreen</code> method and clear the cache in the <code>View::tearDownScreen</code> method:</p><div class="code-header"><div><h5>Screen1View.cpp (extract)</h5></div></div><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly cpp"><pre tabindex="0" class="prism-code language-cpp codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">Screen1View</span><span class="token operator" style="color:rgb(137, 221, 255)">::</span><span class="token function" style="color:rgb(130, 170, 255)">setupScreen</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//ensure background is cached</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token class-name" style="color:rgb(255, 203, 107)">Bitmap</span><span class="token operator" style="color:rgb(137, 221, 255)">::</span><span class="token function" style="color:rgb(130, 170, 255)">cache</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">BITMAP_SCREEN2_ID</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//cache some icons</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token class-name" style="color:rgb(255, 203, 107)">Bitmap</span><span class="token operator" style="color:rgb(137, 221, 255)">::</span><span class="token function" style="color:rgb(130, 170, 255)">cache</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">BITMAP_ICON10_ID</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token class-name" style="color:rgb(255, 203, 107)">Bitmap</span><span class="token operator" style="color:rgb(137, 221, 255)">::</span><span class="token function" style="color:rgb(130, 170, 255)">cache</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">BITMAP_ICON11_ID</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token class-name" style="color:rgb(255, 203, 107)">Bitmap</span><span class="token operator" style="color:rgb(137, 221, 255)">::</span><span class="token function" style="color:rgb(130, 170, 255)">cache</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">BITMAP_ICON12_ID</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">Screen1View</span><span class="token operator" style="color:rgb(137, 221, 255)">::</span><span class="token function" style="color:rgb(130, 170, 255)">tearDownScreen</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//Remove all bitmaps from the cache</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token class-name" style="color:rgb(255, 203, 107)">Bitmap</span><span class="token operator" style="color:rgb(137, 221, 255)">::</span><span class="token function" style="color:rgb(130, 170, 255)">clearCache</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">复制</button></div></div><p>The memory requirement for the cache is the size of the bitmaps used by the screen with the biggest use of bitmaps. The drawback of this method is that if two <code>Views</code> both use a bitmap, the bitmap will be erased from the cache on exit from the first <code>View</code> and cached again on entry to the second <code>View</code>.</p><p>The Bitmap::cacheRemoveBitmap can be used to selective uncache bitmaps and thus reduce this overhead. The drawback of the cacheRemoveBitmap is that the cache memory will be fragmented.</p><p>Another general drawback of caching is that when you change your UI (e.g. adding a button) you may need to update the caching code to include the new bitmap.</p><h3 class="anchor anchorWithStickyNavbar_31ik" id="replace-the-background-bitmaps-in-the-cache">Replace the Background Bitmaps in the Cache<a aria-hidden="true" class="hash-link" href="#replace-the-background-bitmaps-in-the-cache" title="Direct link to heading">​</a></h3><p>If your application has a set of minor bitmaps (e.g. icons) and some large full screen &quot;background&quot; bitmaps another strategy can be advised:</p><p>Cache all the small bitmaps prior to entering the first screen. A good place to do this is in the FrontendApplication constructor. Also cache the background bitmap for the first screen:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly cpp"><pre tabindex="0" class="prism-code language-cpp codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token class-name" style="color:rgb(255, 203, 107)">FrontendApplication</span><span class="token operator" style="color:rgb(137, 221, 255)">::</span><span class="token function" style="color:rgb(130, 170, 255)">FrontendApplication</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">Model</span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;</span><span class="token plain"> m</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> FrontendHeap</span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;</span><span class="token plain"> heap</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> touchgfx</span><span class="token operator" style="color:rgb(137, 221, 255)">::</span><span class="token function" style="color:rgb(130, 170, 255)">MVPApplication</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token function" style="color:rgb(130, 170, 255)">transitionCallback</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token function" style="color:rgb(130, 170, 255)">frontendHeap</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">heap</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token function" style="color:rgb(130, 170, 255)">model</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">m</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//cache some icons</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token class-name" style="color:rgb(255, 203, 107)">Bitmap</span><span class="token operator" style="color:rgb(137, 221, 255)">::</span><span class="token function" style="color:rgb(130, 170, 255)">cache</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">BITMAP_ICON10_ID</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token class-name" style="color:rgb(255, 203, 107)">Bitmap</span><span class="token operator" style="color:rgb(137, 221, 255)">::</span><span class="token function" style="color:rgb(130, 170, 255)">cache</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">BITMAP_ICON11_ID</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token class-name" style="color:rgb(255, 203, 107)">Bitmap</span><span class="token operator" style="color:rgb(137, 221, 255)">::</span><span class="token function" style="color:rgb(130, 170, 255)">cache</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">BITMAP_ICON12_ID</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//cache first background</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token class-name" style="color:rgb(255, 203, 107)">Bitmap</span><span class="token operator" style="color:rgb(137, 221, 255)">::</span><span class="token function" style="color:rgb(130, 170, 255)">cache</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">BITMAP_SCREEN1_ID</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    backgroundBitmapCached </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> BITMAP_SCREEN1_ID</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//remember ID in a variable</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">复制</button></div></div><p>In the <code>View::setupScreen</code> method replace the cached background bitmap with the required bitmap:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly cpp"><pre tabindex="0" class="prism-code language-cpp codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token class-name" style="color:rgb(255, 203, 107)">Screen1View</span><span class="token operator" style="color:rgb(137, 221, 255)">::</span><span class="token function" style="color:rgb(130, 170, 255)">setupScreen</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//ensure background is cached</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token class-name" style="color:rgb(255, 203, 107)">Bitmap</span><span class="token operator" style="color:rgb(137, 221, 255)">::</span><span class="token function" style="color:rgb(130, 170, 255)">cacheReplaceBitmap</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">backgroundBitmapCached</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> BITMAP_SCREEN1_ID</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    backgroundBitmapCached </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> BITMAP_SCREEN1_ID</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//remember new ID of cached bitmap</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">复制</button></div></div><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly cpp"><pre tabindex="0" class="prism-code language-cpp codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">Screen1View</span><span class="token operator" style="color:rgb(137, 221, 255)">::</span><span class="token function" style="color:rgb(130, 170, 255)">tearDownScreen</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//nothing cache related</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">复制</button></div></div><p>The memory requirement for the cache using this strategy is the size of the cached bitmaps and one background bitmap. Compared to the previous method the code is simpler to maintain as the views have less code. The performance is better as we move less bitmaps in and out of the cache.</p><p>The cacheReplaceBitmap operation is preferable to the cacheRemoveBitmap method as it does not fragment the memory.</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="cache-memory-management">Cache Memory Management<a aria-hidden="true" class="hash-link" href="#cache-memory-management" title="Direct link to heading">​</a></h2><p>In order to get the full effect of the bitmap caching it is necessary to understand the internal operations of the cache.</p><p>The cache is implemented as a stack. New bitmaps are cached after the previously cached bitmaps. Memory used by a bitmap is marked as &quot;free&quot; when the bitmap is removed from the cache, but the memory is not immediately useable unless the removed bitmap was on top of the stack. If the bitmap was in &quot;the middle&quot; of the cache a compacting operation is performed the next time Bitmap::cache is called to reclaim the memory. This &quot;costly&quot; method can be avoided if you do not call Bitmap::cache with a &quot;hole&quot; in the cache.</p><p>The drawings below illustrates the principles:</p><ol><li>Caching allocates on top of the previously allocated bitmaps:</li></ol><div class="figure noshadow"><a href="/4.19/zh-CN/img/development/ui-development/touchgfx-engine-features/caching-bitmaps/cache-operations-cache.png" target="_blank"><img width="340" src="/4.19/zh-CN/img/development/ui-development/touchgfx-engine-features/caching-bitmaps/cache-operations-cache.png"></a><p>Allocation sequence of bitmaps in memory</p></div><ol start="2"><li>Removal marks the memory unused:</li></ol><div class="figure noshadow"><a href="/4.19/zh-CN/img/development/ui-development/touchgfx-engine-features/caching-bitmaps/cache-operations-uncache.png" target="_blank"><img width="340" src="/4.19/zh-CN/img/development/ui-development/touchgfx-engine-features/caching-bitmaps/cache-operations-uncache.png"></a><p>Unused memory in cache after removal of cached bitmap</p></div><ol start="3"><li>Allocating the next bitmap compacts the cache and allocates on the top:</li></ol><div class="figure noshadow"><a href="/4.19/zh-CN/img/development/ui-development/touchgfx-engine-features/caching-bitmaps/cache-operations-compact.png" target="_blank"><img width="340" src="/4.19/zh-CN/img/development/ui-development/touchgfx-engine-features/caching-bitmaps/cache-operations-compact.png"></a><p>The cache reclaims unused memory before caching a bitmap</p></div><ol start="4"><li>When you remove the topmost (last allocated) bitmap, the memory is freed immediately along with any free memory just below it:</li></ol><div class="figure noshadow"><a href="/4.19/zh-CN/img/development/ui-development/touchgfx-engine-features/caching-bitmaps/cache-operations-uncache-top.png" target="_blank"><img width="700" src="/4.19/zh-CN/img/development/ui-development/touchgfx-engine-features/caching-bitmaps/cache-operations-uncache-top.png"></a><p>Topmost bitmap cache removal</p></div><p>The next cache operation will in this case not involve a compact.</p><p>This animation shows the whole sequence for this code:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly cpp"><pre tabindex="0" class="prism-code language-cpp codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token class-name" style="color:rgb(255, 203, 107)">Bitmap</span><span class="token operator" style="color:rgb(137, 221, 255)">::</span><span class="token function" style="color:rgb(130, 170, 255)">cache</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">BITMAP_BITMAP1_ID</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token class-name" style="color:rgb(255, 203, 107)">Bitmap</span><span class="token operator" style="color:rgb(137, 221, 255)">::</span><span class="token function" style="color:rgb(130, 170, 255)">cache</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">BITMAP_BITMAP2_ID</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token class-name" style="color:rgb(255, 203, 107)">Bitmap</span><span class="token operator" style="color:rgb(137, 221, 255)">::</span><span class="token function" style="color:rgb(130, 170, 255)">cache</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">BITMAP_BITMAP3_ID</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token class-name" style="color:rgb(255, 203, 107)">Bitmap</span><span class="token operator" style="color:rgb(137, 221, 255)">::</span><span class="token function" style="color:rgb(130, 170, 255)">cacheRemoveBitmap</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">BITMAP_BITMAP2_ID</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token class-name" style="color:rgb(255, 203, 107)">Bitmap</span><span class="token operator" style="color:rgb(137, 221, 255)">::</span><span class="token function" style="color:rgb(130, 170, 255)">cache</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">BITMAP_BITMAP4_ID</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token class-name" style="color:rgb(255, 203, 107)">Bitmap</span><span class="token operator" style="color:rgb(137, 221, 255)">::</span><span class="token function" style="color:rgb(130, 170, 255)">cacheRemoveBitmap</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">BITMAP_BITMAP3_ID</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token class-name" style="color:rgb(255, 203, 107)">Bitmap</span><span class="token operator" style="color:rgb(137, 221, 255)">::</span><span class="token function" style="color:rgb(130, 170, 255)">cacheRemoveBitmap</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">BITMAP_BITMAP4_ID</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">复制</button></div></div><div class="figure noshadow"><a href="/4.19/zh-CN/img/development/ui-development/touchgfx-engine-features/caching-bitmaps/cache-bitmap-animation.gif" target="_blank"><img width="600" src="/4.19/zh-CN/img/development/ui-development/touchgfx-engine-features/caching-bitmaps/cache-bitmap-animation.gif"></a><p>Caching and uncaching bitmaps</p></div></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/4.19/zh-CN/docs/development/ui-development/touchgfx-engine-features/custom-containers"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« <!-- -->自定义容器</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/4.19/zh-CN/docs/development/ui-development/touchgfx-engine-features/custom-widgets"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">自定义小部件<!-- --> »</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#setup-the-bitmap-cache" class="table-of-contents__link toc-highlight">设置位图缓存</a><ul><li><a href="#bitmap-cache-configuration" class="table-of-contents__link toc-highlight">位图缓存配置</a></li><li><a href="#blockcopy-copies-data-from-flash-to-the-cache" class="table-of-contents__link toc-highlight">BlockCopy Copies Data from Flash to the Cache</a></li></ul></li><li><a href="#cache-operations" class="table-of-contents__link toc-highlight">Cache Operations</a></li><li><a href="#cache-strategies" class="table-of-contents__link toc-highlight">Cache Strategies</a><ul><li><a href="#cache-bitmap-on-a-screen-basis" class="table-of-contents__link toc-highlight">Cache Bitmap on a Screen Basis</a></li><li><a href="#replace-the-background-bitmaps-in-the-cache" class="table-of-contents__link toc-highlight">Replace the Background Bitmaps in the Cache</a></li></ul></li><li><a href="#cache-memory-management" class="table-of-contents__link toc-highlight">Cache Memory Management</a></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container"><div class="footer__bottom text--center"><div class="footer__copyright">All rights reserved © 2021 STMicroelectronics | <a href="https://www.st.com/content/st_com/en/common/terms-of-use.html">Terms of use</a> | <a href="https://www.st.com/content/st_com/en/common/privacy-policy.html">Privacy Policy</a> | <a href="/docs/miscellaneous/cookie-policy">Cookie Policy</a> | <a href="https://app-de.onetrust.com/app/#/webform/2b87200d-4023-4588-9df7-ab0cdea1a67e">Exercise your rights</a></div></div></div></footer></div>
<script src="/4.19/zh-CN/assets/js/runtime~main.569d9f0f.js"></script>
<script src="/4.19/zh-CN/assets/js/main.511c8c5c.js"></script>
</body>
</html>