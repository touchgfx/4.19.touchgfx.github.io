<!doctype html>
<html class="docs-version-current" lang="zh-TW" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.9">
<link rel="search" type="application/opensearchdescription+xml" title="TouchGFX Documentation" href="/4.19/zh-TW/opensearch.xml">
<script src="/4.19/js/fix-location.js"></script><title data-react-helmet="true">6. 外部可定址快閃記憶體 | TouchGFX Documentation</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:image" content="https://support.touchgfx.com/4.19/zh-TW/img/meta-image.png"><meta data-react-helmet="true" name="twitter:image" content="https://support.touchgfx.com/4.19/zh-TW/img/meta-image.png"><meta data-react-helmet="true" property="og:url" content="https://support.touchgfx.com/4.19/zh-TW/docs/development/board-bring-up/how-to/06-flash-external-addressable"><meta data-react-helmet="true" name="docsearch:language" content="zh-TW"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="6. 外部可定址快閃記憶體 | TouchGFX Documentation"><meta data-react-helmet="true" name="description" content="Motivation"><meta data-react-helmet="true" property="og:description" content="Motivation"><link data-react-helmet="true" rel="shortcut icon" href="/4.19/zh-TW/img/favicon.png"><link data-react-helmet="true" rel="canonical" href="https://support.touchgfx.com/4.19/zh-TW/docs/development/board-bring-up/how-to/06-flash-external-addressable"><link data-react-helmet="true" rel="alternate" href="https://support.touchgfx.com/4.19/docs/development/board-bring-up/how-to/06-flash-external-addressable" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://support.touchgfx.com/4.19/ko/docs/development/board-bring-up/how-to/06-flash-external-addressable" hreflang="ko"><link data-react-helmet="true" rel="alternate" href="https://support.touchgfx.com/4.19/ja/docs/development/board-bring-up/how-to/06-flash-external-addressable" hreflang="ja"><link data-react-helmet="true" rel="alternate" href="https://support.touchgfx.com/4.19/zh-CN/docs/development/board-bring-up/how-to/06-flash-external-addressable" hreflang="zh-CN"><link data-react-helmet="true" rel="alternate" href="https://support.touchgfx.com/4.19/zh-TW/docs/development/board-bring-up/how-to/06-flash-external-addressable" hreflang="zh-TW"><link data-react-helmet="true" rel="alternate" href="https://support.touchgfx.com/4.19/docs/development/board-bring-up/how-to/06-flash-external-addressable" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://B8LNOI0XWD-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/4.19/zh-TW/assets/css/styles.321a00f7.css">
<link rel="preload" href="/4.19/zh-TW/assets/js/runtime~main.7d7308f7.js" as="script">
<link rel="preload" href="/4.19/zh-TW/assets/js/main.01805fa2.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" target="_self" href="/4.19/zh-TW/docs/introduction/welcome"><div class="navbar__logo"><img src="/4.19/zh-TW/img/logo.svg" alt="TouchGFX" class="themedImage_1VuW themedImage--light_3UqQ"><img src="/4.19/zh-TW/img/logo.svg" alt="TouchGFX" class="themedImage_1VuW themedImage--dark_hz6m"></div></a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" class="navbar__link"><span><span>繁體中文</span></span></a><ul class="dropdown__menu"><li><a href="/4.19/docs/development/board-bring-up/how-to/06-flash-external-addressable" target="_self" rel="noopener noreferrer" class="dropdown__link" style="text-transform:capitalize">English</a></li><li><a href="/4.19/ko/docs/development/board-bring-up/how-to/06-flash-external-addressable" target="_self" rel="noopener noreferrer" class="dropdown__link" style="text-transform:capitalize">한국어</a></li><li><a href="/4.19/ja/docs/development/board-bring-up/how-to/06-flash-external-addressable" target="_self" rel="noopener noreferrer" class="dropdown__link" style="text-transform:capitalize">日本語</a></li><li><a href="/4.19/zh-CN/docs/development/board-bring-up/how-to/06-flash-external-addressable" target="_self" rel="noopener noreferrer" class="dropdown__link" style="text-transform:capitalize">简体中文</a></li><li><a href="/4.19/zh-TW/docs/development/board-bring-up/how-to/06-flash-external-addressable" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" style="text-transform:capitalize">繁體中文</a></li></ul></div></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" href="/4.19/zh-TW/docs/introduction/welcome">4.19</a><ul class="dropdown__menu"><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/4.19/zh-TW/docs/development/board-bring-up/how-to/06-flash-external-addressable">4.19</a></li><li><a href="https://support.touchgfx.com/4.18" target="_blank" rel="noopener noreferrer" class="dropdown__link"><span>4.18<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li><a href="https://support.touchgfx.com/4.17" target="_blank" rel="noopener noreferrer" class="dropdown__link"><span>4.17<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li><a href="https://support.touchgfx.com/4.16" target="_blank" rel="noopener noreferrer" class="dropdown__link"><span>4.16<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li><a href="https://support.touchgfx.com/4.15" target="_blank" rel="noopener noreferrer" class="dropdown__link"><span>4.15<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li><a href="https://support.touchgfx.com/4.14" target="_blank" rel="noopener noreferrer" class="dropdown__link"><span>4.14<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li><a href="https://support.touchgfx.com/4.13" target="_blank" rel="noopener noreferrer" class="dropdown__link"><span>4.13<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><a href="https://community.st.com/s/topic/0TO0X0000003iw6WAA/touchgfx" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Community</a><a href="https://touchgfx.com/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">TouchGFX.com</a><div class="searchBox_1ZXk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_35hR" type="button"></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Introduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Basic Concepts</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Development</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/4.19/zh-TW/docs/development/development-introduction">開發簡介</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Hardware Selection</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#" tabindex="0">Board Bring Up</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/4.19/zh-TW/docs/development/board-bring-up/board-introduction">搭建開發板</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#" tabindex="0">How To</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/4.19/zh-TW/docs/development/board-bring-up/how-to/01-create-project">1. 創建專案</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/4.19/zh-TW/docs/development/board-bring-up/how-to/02-cpu-running">2. CPU的執行</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/4.19/zh-TW/docs/development/board-bring-up/how-to/03-display-internal">3. Display with framebuffer in internal RAM</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/4.19/zh-TW/docs/development/board-bring-up/how-to/04-enable-external-ram">4. External RAM</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/4.19/zh-TW/docs/development/board-bring-up/how-to/05-display-external">5. Display with framebuffer in external RAM</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/4.19/zh-TW/docs/development/board-bring-up/how-to/06-flash-external-addressable">6. 外部可定址快閃記憶體</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/4.19/zh-TW/docs/development/board-bring-up/how-to/07-flash-external-nonaddressable">7. 區塊模式下的外部快閃記憶體</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/4.19/zh-TW/docs/development/board-bring-up/how-to/08-hardware-acceleration">8. 硬體加速器</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/4.19/zh-TW/docs/development/board-bring-up/how-to/09-touch-controller">9. 觸控控制器</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/4.19/zh-TW/docs/development/board-bring-up/how-to/10-physical-buttons">10. 按鈕</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/4.19/zh-TW/docs/development/board-bring-up/how-to/11-flash-loader">11. Flash Loader</a></li></ul></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">TouchGFX AL Development</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">UI Development</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Scenarios</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Miscellaneous</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Tutorials</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">API</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Resources</a></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD theme-doc-toc-mobile tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>6. 外部可定址快閃記憶體</h1></header><h2 class="anchor anchorWithStickyNavbar_31ik" id="motivation">Motivation<a aria-hidden="true" class="hash-link" href="#motivation" title="Direct link to heading">​</a></h2><p>在這一步，我們將在記憶體映射模式下使能外部的Quad或Octo SPI快閃記憶體。 對於大多數專案，建議使用外部快閃記憶體，因為這允許應用程式使用多個大型影像。 即便最普通的應用，內部快閃記憶體也可能會很快被用完。</p><div class="highlight highlight-note"><div class="highlight-heading"><h5><div class="highlight-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></div>Note</h5></div><div class="highlight-content">若開發板不支援外部快閃記憶體，請跳過此步驟。</div></div><p>如欲將資料存放在外部快閃記憶體，必須確保MCU可以讀取外部快閃記憶體。 外部快閃記憶體應以所需的速度運行（通常為最大速度），以獲得最佳性能。</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="goal">Goal<a aria-hidden="true" class="hash-link" href="#goal" title="Direct link to heading">​</a></h2><p>本節的目的為使能外部快閃記憶體，並使用記憶體映射模式，從中讀取數據。 由於外部快閃記憶體的讀取速度對圖形的處理非常重要，因此您應該要測試讀取速度。</p><h3 class="anchor anchorWithStickyNavbar_31ik" id="verification">Verification<a aria-hidden="true" class="hash-link" href="#verification" title="Direct link to heading">​</a></h3><p>Here are the verification points for this section:</p><table><thead><tr><th>Verification Point</th><th>Rationale</th></tr></thead><tbody><tr><td>外部快閃記憶體可讀</td><td>External flash can be used for image storage</td></tr><tr><td>外部快閃記憶體性能</td><td>圖形處理性能在很大程度上取決於記憶體性能</td></tr></tbody></table><h2 class="anchor anchorWithStickyNavbar_31ik" id="prerequisites">Prerequisites<a aria-hidden="true" class="hash-link" href="#prerequisites" title="Direct link to heading">​</a></h2><p>The following are the prerequisites for this step:</p><ul><li>Information about the flash, typically a datasheet</li><li>Information about the connections between the MCU and the external flash</li></ul><h2 class="anchor anchorWithStickyNavbar_31ik" id="do">Do<a aria-hidden="true" class="hash-link" href="#do" title="Direct link to heading">​</a></h2><p>The QSPI controller is configured in STM32CubeMX under Connectivity -&gt; QUADSPI:</p><div class="figure"><a href="/4.19/zh-TW/img/development/board-bring-up/qspi/cubemx-01.png" target="_blank"><img width="600" src="/4.19/zh-TW/img/development/board-bring-up/qspi/cubemx-01.png"></a><p>設定QSPI快閃記憶體</p></div><p>在模式部分，您可以將快閃記憶體配置為單/雙/四資料線。 四資料線最快。 與外部RAM相似，這裡還需選擇和設定用於資料線、晶片選擇和時鐘訊號的GPIO。</p><h3 class="anchor anchorWithStickyNavbar_31ik" id="block-mode">區塊模式<a aria-hidden="true" class="hash-link" href="#block-mode" title="Direct link to heading">​</a></h3><p>使能快閃記憶體後，我們可以通過從中讀取數據來對其進行測試。 The STM32Cube Firmware package contains examples for that.</p><h3 class="anchor anchorWithStickyNavbar_31ik" id="memory-mapped-mode">記憶體映射模式<a aria-hidden="true" class="hash-link" href="#memory-mapped-mode" title="Direct link to heading">​</a></h3><p>使能快閃記憶體的區塊模式並對其進行測試後，必須將其更改為記憶體映射模式。 這將允許CPU直接從快閃記憶體中獲取數據。</p><p>The STM32 STM32Cube HAL contains functions to change to memory mapped mode. 這裡給出了一個範例。 必須通過查閱資料手冊來獲取配置數據。 The STM32Cube Firmware package for your MCU contains more examples.</p><div class="code-header"><div><h5>main.c</h5></div></div><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly cpp"><pre tabindex="0" class="prism-code language-cpp codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">QSPI_CommandTypeDef      s_command</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">QSPI_MemoryMappedTypeDef s_mem_mapped_cfg</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/* Configure the command for the read instruction */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">s_command</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">InstructionMode   </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> QSPI_INSTRUCTION_1_LINE</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">s_command</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">Instruction       </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> QUAD_INOUT_FAST_READ_CMD</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">s_command</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">AddressMode       </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> QSPI_ADDRESS_4_LINES</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">s_command</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">AddressSize       </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> QSPI_ADDRESS_24_BITS</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">s_command</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">AlternateByteMode </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> QSPI_ALTERNATE_BYTES_NONE</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">s_command</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">DataMode          </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> QSPI_DATA_4_LINES</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">s_command</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">DummyCycles       </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> N25Q128A_DUMMY_CYCLES_READ_QUAD</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">s_command</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">DdrMode           </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> QSPI_DDR_MODE_DISABLE</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">s_command</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">DdrHoldHalfCycle  </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> QSPI_DDR_HHC_ANALOG_DELAY</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">s_command</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">SIOOMode          </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> QSPI_SIOO_INST_EVERY_CMD</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/* Configure the memory mapped mode */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">s_mem_mapped_cfg</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">TimeOutActivation </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> QSPI_TIMEOUT_COUNTER_DISABLE</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token function" style="color:rgb(130, 170, 255)">HAL_QSPI_MemoryMapped</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;</span><span class="token plain">QSPIHandle</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;</span><span class="token plain">s_command</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;</span><span class="token plain">s_mem_mapped_cfg</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">!=</span><span class="token plain"> HAL_OK</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> QSPI_ERROR</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">複製</button></div></div><p>If you are using the same flash as one of the STM32 evaluation kits, then the BSP packages for these boards (also in the STM32Cube Firmware) contains valuable examples that can be modified for your hardware.</p><p>當快閃記憶體處於記憶體映射模式時，您可以使用像外部RAM中的代碼那樣對外部快閃記憶體進行測試（在MCU資料表手冊中尋找位址）：</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly cpp"><pre tabindex="0" class="prism-code language-cpp codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">volatile</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">uint32_t</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">externalFlash </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0x90000000</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">uint32_t</span><span class="token plain"> size </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1000</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">volatile</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">uint32_t</span><span class="token plain"> result </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//read external Flash</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">for</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain"> size</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> i</span><span class="token operator" style="color:rgb(137, 221, 255)">++</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    result </span><span class="token operator" style="color:rgb(137, 221, 255)">+=</span><span class="token plain"> externalFlash</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">i</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">複製</button></div></div><p>重新使用先前記憶體效能測試的步驟，以測試外部快閃記憶體的性能。</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/4.19/zh-TW/docs/development/board-bring-up/how-to/05-display-external"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« <!-- -->5. Display with framebuffer in external RAM</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/4.19/zh-TW/docs/development/board-bring-up/how-to/07-flash-external-nonaddressable"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">7. 區塊模式下的外部快閃記憶體<!-- --> »</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#motivation" class="table-of-contents__link toc-highlight">Motivation</a></li><li><a href="#goal" class="table-of-contents__link toc-highlight">Goal</a><ul><li><a href="#verification" class="table-of-contents__link toc-highlight">Verification</a></li></ul></li><li><a href="#prerequisites" class="table-of-contents__link toc-highlight">Prerequisites</a></li><li><a href="#do" class="table-of-contents__link toc-highlight">Do</a><ul><li><a href="#block-mode" class="table-of-contents__link toc-highlight">區塊模式</a></li><li><a href="#memory-mapped-mode" class="table-of-contents__link toc-highlight">記憶體映射模式</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container"><div class="footer__bottom text--center"><div class="footer__copyright">All rights reserved © 2021 STMicroelectronics | <a href="https://www.st.com/content/st_com/en/common/terms-of-use.html">Terms of use</a> | <a href="https://www.st.com/content/st_com/en/common/privacy-policy.html">Privacy Policy</a> | <a href="/docs/miscellaneous/cookie-policy">Cookie Policy</a> | <a href="https://app-de.onetrust.com/app/#/webform/2b87200d-4023-4588-9df7-ab0cdea1a67e">Exercise your rights</a></div></div></div></footer></div>
<script src="/4.19/zh-TW/assets/js/runtime~main.7d7308f7.js"></script>
<script src="/4.19/zh-TW/assets/js/main.01805fa2.js"></script>
</body>
</html>